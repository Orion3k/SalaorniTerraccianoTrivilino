\documentclass[a4paper]{article}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[italian]{babel}
\usepackage{courier}
\usepackage{float}
\usepackage{subcaption}
\usepackage{enumitem}
\usepackage{graphicx}
\usepackage{rotating}
\usepackage{tikz}
\usepackage{makecell}
\graphicspath{{./images/}}
\usepackage{tabularx}
\usepackage{hyperref}
%\usepackage{geometry} 
%\geometry{a4paper,top=3cm,bottom=3cm,left=3.5cm,right=3.5cm,heightrounded,bindingoffset=5mm}

\begin{document}

\author{Manuel Trivilino, Davide Salaorni, Luca Terracciano}

\title{\Large \textbf{Data4Help DD}\\
\textbf{Design Document}
    \begin{figure}[h]
        \centering
        \includegraphics[width=270pt]{data4helpblu}
        \label{fig:my_label_1}
    \end{figure}
    \vspace{-2.4cm}
    \begin{figure}[h]
        \centering
        \includegraphics[width=200pt]{AutomatedSOSlogo.png}
        \label{fig:my_label_2}
    \end{figure}
    \vspace{-2cm}
    \begin{figure}[h]
        \centering
        \includegraphics[width=150pt]{Track4Runlogo.png}
        \label{fig:my_label_3}
\end{figure}
}

\maketitle
\newpage

\tableofcontents
\newpage

\section{Introduction}

\subsection{Purpose}
This document aims to give to the developer team more technical details about the implementation of Data4Help, AutomatedSOS and Track4Run identifying the high level architecture, the design patterns used and the plans that will guide the development of the code.
\vspace{.5 cm}

\subsection{Scope}
\textbf{TrackMe} is a company that develops software-based services for third parties and for consumers. The main service is called Data4Help. \\
\textbf{Data4Help} is a service that allows third parties to monitor the location and the health status of individual, it handles a policy of permissions for each user and collects individual’s data from their personal devices.
The service supports the registration of individuals who, by registering, agree that TrackMe acquires their data. After registration, these third parties can request:

\begin{itemize}
    \item Access to the data of some specific individuals (we can assume, for instance, that they know an 
    individual by his/her social security number or fiscal code in Italy). In this case, TrackMe passes the request to the specific individuals who can accept or refuse it.
    
    \item Access to anonymized data of groups of individuals (for instance, all those living in a certain geographical area, all those of a specific age range, etc.). These requests are handled directly by Data4Help that approves them if it is able to properly anonymize the requested data.\\ 
    For instance, if the third party is asking for data about 10-year-old children living in a certain street in Milano and the number of these children is two, then the third party could be able to derive their identity simply having people monitoring the residents of the street between 8.00 and 9.00 when kids go to school. Then, to avoid this risk and the possibility of a misuse of data, Data4Help will not accept the request. \\ 
    For simplicity, we assume that Data4Help will accept any request for which the number of individuals whose data satisfy the request is higher than 1000.
\end{itemize}
As soon as a request for data is approved, TrackMe makes the previously saved data available to the third party. Also, it allows the third party to subscribe to new data and to receive them as soon as they are produced. \\
TrackMe develops itself two third-party services: AutomatedSOS and Track4Run. \\ \\
\textbf{AutomatedSOS} is a project created by TrackMe and placed on top of Data4Help, which aims to offer a personalized and non-intrusive SOS service to people that are worried about their own safeness and want to have an health inspector always with them. \\ AutomatedSOS, exploiting data provided from Data4Help, monitors the health status of the subscribed customers and, when such parameters are below certain thresholds, sends to the location of the customer an ambulance, guaranteeing a reaction time of less than 5 seconds from the time the parameters are below the threshold. \\ \\
\textbf{Track4Run} is another service offered by TrackMe and conceived for athletes participating in a run, which should allow organizers to define the path for the run, competitors to enroll to the run, and spectators to see on a map the position of all runners during the run. \\
Of course, also in this case, Track4Run will exploit the features offered by Data4Help.
\clearpage

\subsection{Definitions, Acronyms, Abbreviation}

\subsubsection{Definitions}
\begin{itemize}
    \item \textit{Customer:} generic person not registered in any of the services provided by TrackMe. 
    \item \textit{User:} person registered in at least one of the services provided by TrackMe.
    \item \textit{Third Party:} person or company registered in Data4Help that wants to access to the service in order to acquire data.
    \item \textit{Individual Data:} data that belong to a specific user, in particular personal information and data acquired from their devices (i.e. location, health status, etc.).
    \item \textit{Anonymized Data:} aggregated data acquired from a group of users with specific characteristics without keeping track of who they belong to.
    \item \textit{Anonymized Data Subscription:} request that allows third parties to receive new anonymized data as soon as they are produced.
    \item \textit{Ambulance Dispatcher:} the contact center that handles the health care service and the ambulance allocation.
    \item \textit{Google Maps:} web mapping service developed by Google offering satellite imagery, street maps etc.
    \item \textit{Push Notification Service:} web service that offers a fast and secure channel to notify and exchange messages on the web.
    % TODO: rivedere
\end{itemize}

\subsubsection{Acronyms}
\begin{itemize}
    \item \textit{DD:} Design Document
    \item \textit{RASD:} Requirement, Analysis and Specification Document
    \item \textit{GPS:} Global Position System
    \item \textit{API:} Application Programming Interface
    \item \textit{DBMS:} DataBase Management System
    \item \textit{GUI:} Graphical User Interface
    \item \textit{MVC:} Model-View-Controller pattern
    % TODO: rivedere
\end{itemize}

\subsubsection{Abbreviations}
\begin{itemize}
    \item \textit{R.n} Requirement number n
    % TODO: rivedere
\end{itemize}
\clearpage    

% REVISION HISTORY
% REFERENCE DOCUMENTS

\subsection{Document Structure}
The document consists of five sections:
\begin{enumerate}[label*=\bf{\arabic*.}]
    \item \textbf{Introduction:} this section provides a general introduction to the Design Document and aims to establish its purpose and scope, giving some guidelines for the correct understanding of the document.
    \item \textbf{Architectural Design:} this section gives an overview of the project structure. Indeed, it includes diagrams which show components, sub-components and interfaces, underlining the relationship among them. The analysis starts from a high-level view and it goes down deeper and deeper to touch more specific entities, considering also architectural styles and patterns.  
    \item \textbf{User Interface Design:} this section provides an overview on how the user interfaces of the system look like and behave depending on the different inputs.
    \item \textbf{Requirements Traceability:} this section describes how requirements defined in the RASD are mapped to the design elements shown in this document.
    \item \textbf{Implementation, Integration and Test Plan:} this section explains the order in which has been decided to implement the sub-components of the system and in which has been planned to integrate those sub-components, describing the testing phase for the entire structure.
\end{enumerate}

\clearpage

\section{Architectural Design}

\paragraph{Data4Help}

\begin{itemize}
    \item \textbf{Presentation Layer}
    
    \item \textbf{Business Logic Layer} This layer is made up by the web app interface 
    
    \item \textbf{Data Layer}
    
\end{itemize}

\paragraph{AutomatedSOS}

\paragraph{Track4Run}

\subsection{Overview}

\subsection{High-level Architecture}

\clearpage

\subsection{Component View}
Services:
\begin{enumerate}
    %Data4Help
    \item RegistrationService
    \item LoginService
    \item PermissionRequestService %Riceve le richieste di permessi e le smista in base al tipo ai due servizi scritti sotto
    \item AnonymousPermissionMaker
    \item IndividualPermissionMaker
    \item IndividualPermissionService %gestisce le individual
    \item AnonymousPermissionService %gestisce le  anonime
    \item IndividualDataService %Accede al db e elabora i dati per mandarli in uscita
    \item AnonymousDataService %Accede al db e elabora i dati per mandarli in uscita
    
    %AutomatedSOS
    \item MonitorStatusService
    \item EmergencyService
    
    %Track4Run
    \item RunCreationService %creazione corsa
    \item RunManagementService %Gestione pre corsa(Aggiunta partecipanti)
    \item RunTrackingService %Gestione durante la corsa
    \item RunWatchService %Gestione spettatori durante la corsa
    
\end{enumerate}

\subsection{Deployment View}
The Deployment diagram focuses on how the software is deployed to the target nodes.

For convenience this section is split in three parts, one for each software product.

\paragraph{Data4Help}
This section is devoted to Data4Help analysis. First of all, the Data4Help Data Collector Process which is the software components that collects the data from the smart devices is installed on the user's smartphone. In this node there is a composition relation with a generic Third Party application that uses the service provided by Data4Help in order to use the API for collecting data. The artifact, actually, is not available in a stand alone version but it has to be included in the app that will use the Data4Help service. We made this choice because we think that the service offered by Data4Help is useful only when a third party application (such as AutomatedSOS and Track4Run do) requires the user's data, otherwise is not reasonable to think that a user will install only the Process for sharing his/her own data.
Another aspect that needs to be clarified is that the Sensor Data Collector artifact is an ad-hoc software developed by the smart device manufacturer and not by TrackMe so it has been added for better understand the environment in which the Process on the client side will operate.
It is also available a web interface for Data4Help in order to manage credentials and, for what concerns the third parties, ask for user's data.
The server side of the application contains the business logic, such as the permissions management and the data anonymizing process, and it is deployed to the Data4Help Server component which also interacts with a dedicated database.

\paragraph{AutomatedSOS}
AutomatedSOS is designed as it is a third party application in order to reuse the same software stack used in Data4Help. Since AutomatedSOS is built on top of Data4Help, is necessary deploy the Data Collector Process in the user's smartphone. The user can also install an additional app on his/her smartwatch to see the health status in real time. The artifact deployed on the smartphone calculates in background if the health parameters are acceptable with respect to the threshold values. On the server side the AutomatedSOS server handles the emergency message sent by the smartphone and it notifies the Ambulance Dispatcher. Another functionality implemented on the server is the computation of the threshold value for a single user which will be sent to the smartphone application.

\paragraph{Track4Run}
Track4Run is built on top of Data4Help as AutomatedSOS so the previos considerations actuall hold for this application. The smartphone app allows the user to create, enroll and watch a run by communicating with the Track4Run server. It is also responsible for retrieving the data from the external map service (in this case Google Maps) and to mirror the major informations like the path during a run on the smartwatch app. Ther server app handles the runs management, the request of the spectator giving them the updated runner's position and all the routines which preceeds the start of the run event.



In fact this nodes are:


\begin{itemize}
    \item Smart device: 
    \item Website:
    \item Third Party server:
    \item Data4Help Server
    \item Database
\end{itemize}

\clearpage

\subsection{Runtime View}
Before starting the runtime analysis there a note that has to be clarified: not all the message types that appear in the sequence diagrams are represented in the class diagram because they are used as wrappers for different data type (i.e. retrieving a user tuple from the database).

\subsubsection{AutomatedSOS - Alert Emergency Status}
The diagram shows the routine executed by AutomatedSOS when a user enters in the emergency status. In the view there is a subroutine which is periodically invoked in the client application to request the updated threshold values to the server. After the request of the user health status to the Data4Help Data Collector Process the application compares them with their threshold values and, once it has verified that the safety constraint is not respected, contacts the Emergency Service sending the User and his/her current position. A notification is sent while an ack is not received from the Emergency Service and, after that, the user is informed that an ambulance has been called. Otherwise if the user is not in danger the health status is regularly showed in the application.

\subsubsection{Track4Run - Create and enroll in a run}
The creation of a run start with a specific request sent from the mobile application in which are specified the user, the startind and ending point, the date and the hour at which the run will start.
Concerning the enrollment the user will search from the mobile application through the list of available run the one in which he/she wants to enroll. Thus the user is added to the runner of the event and will receive a confirmation message.

\subsubsection{Track4Run - Watch a run}
When a user wants to watch a run first of all he/she send a request to the Track4Run Server using the Client Interface, selects the run from a list obtained applying some filters (i.e. the city of the event) and then contact the Run Watch Service. This component contacts the Run Tracking Service, retrieves the position of the runners and it sends the data to the smartphone. It is also possible to see the ranking of the run in real time contacting directly the Run Tracking service.

\subsubsection{Data4Help - Third Party requires the permission to access to a specific user data}
This sequence diagram shows the case in which a third party requires to access to specific user data and how the system manage the permission.
The third party, through the web interface or through its app, requires for the permission, indicating the users involved. A permission Request is sent to the Data4Help Server, where the RequestHandlerService manage it and invoke the creation of the individual permission in the IndividualPermissionMaker. This service shall forward the request that has to be accepted or refused from the user and receives the response. If the user allows to acquire his data, the permission is stored in the IndividualPermissionService and finally the Third Party is notified that the request is accepted.
On the contrary, if the user refuses to share his data it is not stored any permission in the system and the third party is notified that the request is not accepted.

\subsubsection{Data4Help - Third Party requires to acquire some individual data}
This sequence diagram shows the case in which a third party requires to some individual user's data.
The third party, through the web interface or through its app, requires for the data, indicating the user. A permission Request is sent to the Data4Help Server, where the RequestHandlerService manage it and check in the IndividualPermissionService if the related permission already exists.
If the permission does not exist the process to create a new permission is invoked.
Otherwise if the permission already exists, the RequestHandlerService invokes the IndividualPermissionService to fetch and send the data and finally the IndividualDataService sends to the Third Party the required data.

\subsubsection{Data4Help - Third Party requires for anonymazed data}
This sequence diagram shows the case in which a third party requires to some anonymazed data from a group of target users.
The third party, through the web interface or through its app, requires for the data, indicating the filters and the target to group the users.
A permission Request is sent to the Data4Help Server, where the RequestHandlerService manage it and invoke the creation of the anonymous permission in the AnonymousPermissionMaker.
The AnonymousPermissionMaker then requires the data for the "one-shot" request to the AnonymousDataService that check if the data can be anonymazed or not, if it is possible the data is sent to to the third party. Otherwise the third party is notified that it is not possible to share data and guarantee the user anonymity.

\subsubsection{Data4Help - Third party to subscribe for anonymazed data}
This sequence diagram shows the case in which a third party requires to some anonymazed data from a group of target users.
The third party, through the web interface or through its app, requires for the data, indicating the filters and the target to group the users.
A permission Request is sent to the Data4Help Server, where the RequestHandlerService manage it and invoke the creation of the anonymous permission in the AnonymousPermissionMaker.
the AnonymousPermissionMaker invokes the AnonymousPermissionService to store the subscription permission.
Then the data is sent to the third party periodically as already described in the anonymous data request until the third party unsubscribes. 

\subsection{Component Interfaces}

\subsection{Selected Architectural Styles and Patterns}
\begin{itemize}
    \item Visitor pattern
    \item Command pattern
    \item Thick Client configuration
\end{itemize}

\subsubsection{Design Pattern}

\begin{itemize}
    \item \textbf{Layer Pattern}
     Data4Help, AutomatedSOS and Track4Run are structured in layers, the functions are decomposed in group of subtasks: presentation layer, application layer, data (persistence) layer.
     
    \item \textbf{Client-Server Pattern} The three services are based on the Server-Client pattern. Data4Help and also AutomatedSOS and Track4Run, are composed by a server that computes the main functions, otherwise the client has the function to let the user interface to the services.
    
    \item \textbf{Model-View-Controller Pattern} To guarantee better modularity all the services are based on the MVC pattern, the application is divided in three parts: Model, View, Controller. The Model lies in the servers and performs the application and persistence tasks, it is managed by the controller that lies both in server and in the clients. Finally the View, that performs the interface through which the users access and control the services, lies on the clients. This pattern allows to reduce coupling among the core functions of the services and the interface.
    
    \item \textbf{Facade Pattern} In order to make complex subsystems easier to use and to reducing the dependencies among them, facade pattern is used in all of the three service offered by TrackMe. The main systems are divided into smaller components, they communicate with each others through interfaces. Thanks to this solution the single components do not have to touch the internal state neither to know the internal implementation of other parts.
    
\end{itemize}

\subsection{Other Design Decision}

\section{User Interface Design}

\section{Requirements Traceability}

\begin{enumerate}[label*=\bf{R.\arabic*}]

\item - People can create a user account selecting username, password,
giving personal information (age, address,gender) and allow to
share their anonymized data.

\begin{itemize}
\item RegistrationService
\end{itemize}

\item - It is possible to create a third party account selecting username
and password and giving the company main information.

\begin{itemize}
\item LoginService
\end{itemize}

\item - Data4Help allows third parties to request anonymized data acquired
from a filtered group of users (by age, gender, address, etc.).

\begin{itemize}
\item RequestHandlerService
\end{itemize}

\item Data4Help collects data from registered users and gives access to
third parties only if the number of individuals whose data satisfy the
request is higher than 1000.

\begin{itemize}
\item RequestHandlerService
\item AnonymousPermissionMaker
\item AnonymousPermissionService
\item AnonymousDataService
\end{itemize}

\item - Data4Help allows third parties to join the subscription service for an
indeterminate period and then, in case, unsubscribe from that.

\begin{itemize}
\item RequestHandlerService
\item AnonymousPermissionMaker
\item AnonymousPermissionService
\end{itemize}

\item - Data4Help provides new data, checking each time if groups data satisfy the given constraint (number of individuals not lower than a
thousand).

\begin{itemize}
\item AnonymousDataService
\end{itemize}

\item - Data4Help keeps track of the associations between third parties subscriptions and the required group data.

\begin{itemize}
\item AnonymousPermissionService
\end{itemize}

\item - Data4Help allows third parties to require specific person’s data.

\begin{itemize}
\item RequestHandlerService
\end{itemize}

\item - Data4Help forwards requests from third parties to the demanded users which can accept or refuse to share their own personal data.

\begin{itemize}
\item IndividualPermissionMaker
\end{itemize}

\item - Data4Help keeps track of the connections between a specific user and the third parties which can access to his/her data.

\begin{itemize}
\item RequestHandlerService
\item IndividualPermissionService
\item IndividualDataService
\end{itemize}

\item - Data4Help allows third parties to have access to demanded users’ data each time they need them.

\begin{itemize}
\item RequestHandlerService
\item IndividualPermissionService
\item IndividualDataService
\end{itemize}

\item - Users’ health and position information received from Data4Help data collector process are analyzed and compared with the threshold values.

\begin{itemize}
\item MonitorStatusService
\end{itemize}

\item - In case of emergency (the health status values overcome the threshold) a request for an ambulance is sent to the ambulance dispatcher in 5 seconds, containing the user’s information.

\begin{itemize}
\item EmergencyService
\end{itemize}

\item - Users select the day, the hour at which the run begins, the starting point, the ending point and the path for the run.

\begin{itemize}
\item RunCreationService
\end{itemize}

\item - The run event is stored in the system in order to be managed during its lifecycle.

\begin{itemize}
\item RunManagementService
\end{itemize}

\item - Users can browse among the available runs and see their information.

\begin{itemize}
\item RunManagementService
\end{itemize}

\item - Users can choose a run and register to it as a runners.

\begin{itemize}
\item RunManagementService
\end{itemize}

\item - The system saves the enrolled users as runners and keeps track of the association with the run event.

\begin{itemize}
\item RunManagementService
\end{itemize}

\item - The system keeps track of all the enrolled runners’ position during the run.

\begin{itemize}
\item RunTrackingService
\end{itemize}

\item - Users who require to watch a run are saved as spectators to the run event.

\begin{itemize}
\item RunWatchService
\end{itemize}

\item - Track4Run offers the possibility to see the run live through a map.

\begin{itemize}
\item RunWatchService
\item RunTrackingService
\end{itemize}

\end{enumerate}

\section{Implementation, Integration and Test Plan}

\section{Effort Spent}

\section{References}

\end{document}
